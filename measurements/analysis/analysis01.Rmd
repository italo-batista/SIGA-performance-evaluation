---
output: pdf_document
---

```{r setup, include=FALSE}
install.packages("knitr")
install.packages("dplyr")
install.packages("ggplot2")

knitr::opts_chunk$set(echo = TRUE)
```

```{r warning=FALSE, message=FALSE, error=FALSE}
library(dplyr)
library(ggplot2)
```

```{r warning=FALSE, message=FALSE, error=FALSE}
get.80.1g = read.csv2(file="../data/1GB/request_get_80_reports_pdf.csv", sep = ",")
get.180.1g = read.csv2(file="../data/1GB/request_get_180_consumptions.csv", sep=",")
post.80.1g = read.csv2(file="../data/1GB/request_post_80_create_water_consumption.csv", sep=",")
post.180.1g = read.csv2(file="../data/1GB/request_post_180_create_water_consumptions.csv", sep=",")

get.80.500m = read.csv2(file="../data/500MB/request_get_80_reports_pdf.csv", sep = ",")
get.180.500m = read.csv2(file="../data/500MB/request_get_180_consumptions.csv", sep=",")
post.80.500m = read.csv2(file="../data/500MB/request_post_80_create_water_consumption.csv", sep=",")
post.180.500m = read.csv2(file="../data/500MB/request_post_180_create_water_consumptions.csv", sep=",")

get.80.80m = read.csv2(file="../data/80MB/request_get_80_reports_pdf.csv", sep = ",")
get.180.80m = read.csv2(file="../data/80MB/request_get_180_consumptions.csv", sep=",")
post.80.80m = read.csv2(file="../data/80MB/request_post_80_create_water_consumption.csv", sep=",")
post.180.80m = read.csv2(file="../data/80MB/request_post_180_create_water_consumptions.csv", sep=",")


get.180.1g["TIPO_REQUISICAO"] <- 'GET'
get.180.500m["TIPO_REQUISICAO"] <- 'GET'
get.180.80m["TIPO_REQUISICAO"] <- 'GET'

get.80.1g["TIPO_REQUISICAO"] <- 'GET'
get.80.500m["TIPO_REQUISICAO"] <- 'GET'
get.80.80m["TIPO_REQUISICAO"] <- 'GET'
```

```{r warning=FALSE, message=FALSE, error=FALSE}
get_timestamp_diff <- function(df){
  
  begin = df %>% filter(df$MOMENTO == "BEGIN")
  end = df %>% filter(df$MOMENTO == "END")
  
  df = left_join(begin, end, by=c("ID", "TIPO_REQUISICAO"))
  df$TIMESTAMP = (df$TIMESTAMP.y / 1000000) - (df$TIMESTAMP.x / 1000000)
  df = df %>% select("ID", "TIPO_REQUISICAO", "TIMESTAMP")

  return(df)
}
```

```{r warning=FALSE, message=FALSE, error=FALSE}
get.180.1g = get_timestamp_diff(get.180.1g)
get.180.500m = get_timestamp_diff(get.180.500m)
get.180.80m = get_timestamp_diff(get.180.80m)
get.80.1g = get_timestamp_diff(get.80.1g)
get.80.500m = get_timestamp_diff(get.80.500m)
get.80.80m = get_timestamp_diff(get.80.80m)
post.180.1g = get_timestamp_diff(post.180.1g)
post.180.500m = get_timestamp_diff(post.180.500m)
post.180.80m = get_timestamp_diff(post.180.80m)
post.80.1g = get_timestamp_diff(post.80.1g)
post.80.500m = get_timestamp_diff(post.80.500m)
post.80.80m = get_timestamp_diff(post.80.80m)
```

```{r warning=FALSE, message=FALSE, error=FALSE}
get.180.1g["RAM"] <- 1024
get.180.500m["RAM"] <- 500
get.180.80m["RAM"] <- 80

get.180.1g["REQ_MIN"] <- 180
get.180.500m["REQ_MIN"] <- 180
get.180.80m["REQ_MIN"] <- 180

post.180.1g["RAM"] <- 1024
post.180.500m["RAM"] <- 500
post.180.80m["RAM"] <- 80

post.180.1g["REQ_MIN"] <- 180
post.180.500m["REQ_MIN"] <- 180
post.180.80m["REQ_MIN"] <- 180


get.80.1g["RAM"] <- 1024
get.80.500m["RAM"] <- 500
get.80.80m["RAM"] <- 80

get.80.1g["REQ_MIN"] <- 80
get.80.500m["REQ_MIN"] <- 80
get.80.80m["REQ_MIN"] <- 80

post.80.1g["RAM"] <- 1024
post.80.500m["RAM"] <- 500
post.80.80m["RAM"] <- 80

post.80.1g["REQ_MIN"] <- 80
post.80.500m["REQ_MIN"] <- 80
post.80.80m["REQ_MIN"] <- 80

post.all <- rbind(post.180.1g,post.180.500m,post.180.80m,post.80.1g,post.80.500m,post.80.80m)
get.all <- rbind(get.180.1g,get.180.500m,get.180.80m,get.80.1g,get.80.500m,get.80.80m)
tests <- rbind(post.all, get.all)
```


```{r  warning=FALSE, message=FALSE, error=FALSE}
# Check the ylim
plot(log10(TIMESTAMP) ~ RAM, data = post.all)

posts_by_ram <- ggplot(data = post.all, aes(x=as.factor(RAM), y=log10(TIMESTAMP), colour=as.factor(REQ_MIN))) + geom_boxplot()
  #geom_jitter(size=1, alpha=0.4, width=0.4, height=0.1) 
posts_by_ram +labs(colour = "Requisições por minuto", x="Memória RAM Disponível (MB)", y= "Tempo de resposta (em milisegundo)")


posts_by_req <- ggplot(data = post.all, aes(x=as.factor(REQ_MIN), y=log10(TIMESTAMP), colour=as.factor(RAM)))  + geom_boxplot()
  #geom_jitter(size=1, alpha=0.4, width=0.4, height=0.1) 
posts_by_req + ylim(1,2) +labs(colour = "Memória RAM Disponível (MB)", x="Requisições por minuto", y= "Tempo de resposta (em milisegundo)")


#GET
gets_by_ram <- ggplot(data = get.all, aes(x=as.factor(RAM), y=log10(TIMESTAMP), colour=as.factor(REQ_MIN))) + geom_boxplot()
  #geom_jitter(size=1, alpha=0.4, width=0.4, height=0.1) 
gets_by_ram +labs(colour = "Requisições por minuto", x="Memória RAM Disponível (MB)", y= "Tempo de resposta (em milisegundo)")


gets_by_req <- ggplot(data = get.all, aes(x=as.factor(REQ_MIN), y=log10(TIMESTAMP), colour=as.factor(RAM)))  + geom_boxplot()
  #geom_jitter(size=1, alpha=0.4, width=0.4, height=0.1) 
gets_by_req + ylim(1,2) +labs(colour = "Memória RAM Disponível (MB)", x="Requisições por minuto", y= "Tempo de resposta (em milisegundo)")

ggplot(data = tests, aes(x=as.factor(TIPO_REQUISICAO), y=TIMESTAMP, colour=as.factor(RAM))) +
  geom_jitter(size=1, alpha=0.4, width=0.4, height=0.1)
```

